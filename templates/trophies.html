{% extends "base.html" %}

{% block title %}Trophées - Dev Learning Hub{% endblock %}

{% block content %}
<div class="trophies-container">
    <div class="trophies-header">
        <h1 class="page-title">
            <i class="fas fa-trophy"></i>
            Collection de Trophées
        </h1>
        <p class="page-subtitle">Débloquez des récompenses en progressant dans vos apprentissages</p>
        
        <div class="trophies-stats">
            <div class="trophy-stat">
                <div class="stat-number">{{ user_trophy_ids|length }}</div>
                <div class="stat-label">Obtenus</div>
            </div>
            <div class="trophy-stat">
                <div class="stat-number">{{ trophies|length - user_trophy_ids|length }}</div>
                <div class="stat-label">Restants</div>
            </div>
            <div class="trophy-stat">
                <div class="stat-number">{{ trophies|length }}</div>
                <div class="stat-label">Total</div>
            </div>
        </div>
    </div>
    
    <div class="trophies-sections">
        {% for tier in ['bronze', 'silver', 'gold', 'platinum'] %}
        {% set tier_trophies = trophies|selectattr('tier', 'equalto', tier)|list %}
        {% if tier_trophies %}
        <div class="trophy-tier-section">
            <h2 class="tier-title {{ tier }}">
                {% if tier == 'bronze' %}
                    <i class="fas fa-medal"></i>
                    Trophées Bronze
                {% elif tier == 'silver' %}
                    <i class="fas fa-medal"></i>
                    Trophées Argent
                {% elif tier == 'gold' %}
                    <i class="fas fa-medal"></i>
                    Trophées Or
                {% elif tier == 'platinum' %}
                    <i class="fas fa-gem"></i>
                    Trophées Platine
                {% endif %}
            </h2>
            
            <div class="trophies-grid">
                {% for trophy in tier_trophies %}
                {% set is_earned = trophy.id in user_trophy_ids %}
                
                <div class="trophy-card {{ tier }} {% if is_earned %}earned{% endif %}">
                    <div class="trophy-icon">
                        <i class="{{ trophy.icon }}"></i>
                        {% if is_earned %}
                        <div class="earned-badge">
                            <i class="fas fa-check"></i>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="trophy-content">
                        <h3 class="trophy-name">{{ trophy.name }}</h3>
                        <p class="trophy-description">{{ trophy.description }}</p>
                        
                        <div class="trophy-condition">
                            {% if trophy.condition_type == 'lessons' %}
                                <i class="fas fa-book"></i>
                                {% if trophy.condition_value == 1 %}
                                    Complétez 1 leçon
                                {% else %}
                                    Complétez {{ trophy.condition_value }} leçons
                                {% endif %}
                            {% elif trophy.condition_type == 'points' %}
                                <i class="fas fa-coins"></i>
                                Gagnez {{ trophy.condition_value }} points
                            {% elif trophy.condition_type == 'courses' %}
                                <i class="fas fa-graduation-cap"></i>
                                {% if trophy.condition_value == 1 %}
                                    Terminez 1 cours
                                {% else %}
                                    Terminez {{ trophy.condition_value }} cours
                                {% endif %}
                            {% endif %}
                        </div>
                        
                        {% if is_earned %}
                        <div class="trophy-earned-date">
                            {% for user_trophy in current_user.user_trophies %}
                                {% if user_trophy.trophy_id == trophy.id %}
                                    <i class="fas fa-calendar"></i>
                                    Obtenu le {{ user_trophy.earned_at.strftime('%d/%m/%Y') }}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="trophy-progress">
                            {% if trophy.condition_type == 'lessons' %}
                                {% set progress = (current_user.completed_lessons|length / trophy.condition_value * 100)|round %}
                                <div class="progress-info">
                                    <span>{{ current_user.completed_lessons|length }}/{{ trophy.condition_value }}</span>
                                    <span>{{ progress|int }}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ [progress, 100]|min }}%"></div>
                                </div>
                            {% elif trophy.condition_type == 'points' %}
                                {% set progress = (current_user.points / trophy.condition_value * 100)|round %}
                                <div class="progress-info">
                                    <span>{{ current_user.points }}/{{ trophy.condition_value }}</span>
                                    <span>{{ progress|int }}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ [progress, 100]|min }}%"></div>
                                </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    
    <div class="back-to-dashboard">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Retour au dashboard
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation des trophées
    const trophyCards = document.querySelectorAll('.trophy-card');
    trophyCards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in-up');
    });
    
    // Animation des barres de progression
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach((bar, index) => {
        setTimeout(() => {
            bar.style.transition = 'width 1s ease-in-out';
        }, index * 200 + 500);
    });
    
    // Effet de survol pour les trophées non obtenus
    trophyCards.forEach(card => {
        if (!card.classList.contains('earned')) {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        }
    });
});
</script>
{% endblock %}
