{% extends "base.html" %}

{% block title %}Certificat - {{ course.name }} - Dev Learning Hub{% endblock %}

{% block content %}
<div class="certificate-container">
    <div class="certificate-wrapper">
        <!-- Certificate Design -->
        <div class="certificate" id="certificate">
            <!-- Background Pattern -->
            <div class="certificate-bg-pattern"></div>
            
            <!-- Header -->
            <div class="certificate-header">
                <div class="certificate-logo">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h1 class="certificate-title">CERTIFICAT DE RÉUSSITE</h1>
                <div class="certificate-subtitle">Dev Learning Hub</div>
            </div>
            
            <!-- Content -->
            <div class="certificate-content">
                <div class="certificate-text">
                    <p class="intro-text">Ce certificat atteste que</p>
                    <h2 class="student-name">{{ current_user.username }}</h2>
                    <p class="completion-text">
                        a terminé avec succès le cours
                    </p>
                    <h3 class="course-name">{{ course.name }}</h3>
                    <p class="description-text">
                        {{ course.description }}
                    </p>
                </div>
                
                <!-- Stats -->
                <div class="certificate-stats">
                    <div class="stat-item">
                        <div class="stat-value">{{ completion_stats.lessons_completed }}</div>
                        <div class="stat-label">Leçons Complétées</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ completion_stats.quiz_score }}%</div>
                        <div class="stat-label">Score Quiz</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ completion_stats.total_points }}</div>
                        <div class="stat-label">Points Gagnés</div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="certificate-footer">
                <div class="certificate-info">
                    <div class="issue-date">
                        <strong>Date d'émission:</strong>
                        <span>{{ completion_date.strftime('%d/%m/%Y') }}</span>
                    </div>
                    <div class="certificate-id">
                        <strong>ID Certificat:</strong>
                        <span>DLH-{{ course.id }}-{{ current_user.id }}-{{ completion_date.strftime('%Y%m%d') }}</span>
                    </div>
                </div>
                
                <div class="certificate-signature">
                    <div class="signature-line"></div>
                    <div class="signature-text">Dev Learning Hub</div>
                    <div class="signature-title">Plateforme d'Apprentissage</div>
                </div>
            </div>
            
            <!-- Decorative Elements -->
            <div class="certificate-corner top-left"></div>
            <div class="certificate-corner top-right"></div>
            <div class="certificate-corner bottom-left"></div>
            <div class="certificate-corner bottom-right"></div>
            
            <!-- Seal -->
            <div class="certificate-seal">
                <div class="seal-inner">
                    <i class="fas fa-star"></i>
                    <div class="seal-text">CERTIFIÉ</div>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="certificate-actions">
            <button class="btn btn-primary me-2" onclick="downloadCertificate()">
                <i class="fas fa-download me-2"></i>Télécharger PDF
            </button>
            <button class="btn btn-success me-2" onclick="shareCertificate()">
                <i class="fas fa-share me-2"></i>Partager
            </button>
            <a href="{{ url_for('course_detail', course_id=course.id) }}" class="btn btn-outline-light">
                <i class="fas fa-arrow-left me-2"></i>Retour au cours
            </a>
        </div>
    </div>
</div>

<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark border-primary">
            <div class="modal-header border-primary">
                <h5 class="modal-title text-primary">
                    <i class="fas fa-share me-2"></i>Partager votre certificat
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <div class="row">
                        <div class="col-6 mb-3">
                            <button class="btn btn-outline-primary w-100" onclick="shareOnLinkedIn()">
                                <i class="fab fa-linkedin me-2"></i>LinkedIn
                            </button>
                        </div>
                        <div class="col-6 mb-3">
                            <button class="btn btn-outline-info w-100" onclick="shareOnTwitter()">
                                <i class="fab fa-twitter me-2"></i>Twitter
                            </button>
                        </div>
                        <div class="col-6 mb-3">
                            <button class="btn btn-outline-success w-100" onclick="copyLink()">
                                <i class="fas fa-link me-2"></i>Copier le lien
                            </button>
                        </div>
                        <div class="col-6 mb-3">
                            <button class="btn btn-outline-warning w-100" onclick="shareByEmail()">
                                <i class="fas fa-envelope me-2"></i>Email
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <label class="form-label">Lien de partage:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="shareLink" readonly 
                               value="{{ request.url_root }}certificate/{{ course.id }}/{{ current_user.id }}">
                        <button class="btn btn-outline-secondary" type="button" onclick="copyShareLink()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.certificate-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}

.certificate-wrapper {
    max-width: 800px;
    width: 100%;
}

.certificate {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border: 8px solid #d4af37;
    border-radius: 20px;
    padding: 3rem;
    margin-bottom: 2rem;
    position: relative;
    box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
    color: #333;
    overflow: hidden;
}

.certificate-bg-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(212, 175, 55, 0.05) 0%, transparent 50%);
    pointer-events: none;
}

.certificate-header {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 2;
}

.certificate-logo {
    font-size: 3rem;
    color: #d4af37;
    margin-bottom: 1rem;
}

.certificate-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #d4af37;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 0.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

.certificate-subtitle {
    font-size: 1.2rem;
    color: #666;
    font-weight: 300;
    letter-spacing: 1px;
}

.certificate-content {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 2;
}

.intro-text {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 1rem;
    font-style: italic;
}

.student-name {
    font-size: 2.2rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 1rem 0;
    text-decoration: underline;
    text-decoration-color: #d4af37;
    text-underline-offset: 8px;
    text-decoration-thickness: 3px;
}

.completion-text {
    font-size: 1.1rem;
    color: #666;
    margin: 1rem 0;
}

.course-name {
    font-size: 1.8rem;
    font-weight: 600;
    color: #27ae60;
    margin: 1rem 0;
}

.description-text {
    font-size: 1rem;
    color: #7f8c8d;
    margin: 1rem 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.certificate-stats {
    display: flex;
    justify-content: space-around;
    margin: 2rem 0;
    padding: 1rem;
    background: rgba(212, 175, 55, 0.1);
    border-radius: 10px;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #d4af37;
}

.stat-label {
    font-size: 0.9rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.certificate-footer {
    display: flex;
    justify-content: space-between;
    align-items: end;
    margin-top: 2rem;
    position: relative;
    z-index: 2;
}

.certificate-info {
    font-size: 0.9rem;
    color: #666;
}

.certificate-info div {
    margin-bottom: 0.5rem;
}

.certificate-signature {
    text-align: center;
}

.signature-line {
    width: 200px;
    height: 2px;
    background: #333;
    margin-bottom: 0.5rem;
}

.signature-text {
    font-weight: 600;
    color: #333;
}

.signature-title {
    font-size: 0.8rem;
    color: #666;
}

.certificate-corner {
    position: absolute;
    width: 40px;
    height: 40px;
    border: 4px solid #d4af37;
}

.certificate-corner.top-left {
    top: 20px;
    left: 20px;
    border-right: none;
    border-bottom: none;
}

.certificate-corner.top-right {
    top: 20px;
    right: 20px;
    border-left: none;
    border-bottom: none;
}

.certificate-corner.bottom-left {
    bottom: 20px;
    left: 20px;
    border-right: none;
    border-top: none;
}

.certificate-corner.bottom-right {
    bottom: 20px;
    right: 20px;
    border-left: none;
    border-top: none;
}

.certificate-seal {
    position: absolute;
    bottom: 30px;
    right: 50px;
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, #d4af37 0%, #b8941f 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    transform: rotate(-15deg);
}

.seal-inner {
    text-align: center;
    color: white;
    font-weight: 700;
}

.seal-inner i {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.2rem;
}

.seal-text {
    font-size: 0.7rem;
    letter-spacing: 1px;
}

.certificate-actions {
    text-align: center;
}

.certificate-actions .btn {
    margin: 0.5rem;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

@media print {
    .certificate-actions {
        display: none;
    }
    
    .certificate-container {
        background: white;
        min-height: auto;
    }
    
    .certificate {
        box-shadow: none;
        margin: 0;
    }
}

@media (max-width: 768px) {
    .certificate {
        padding: 2rem 1rem;
    }
    
    .certificate-title {
        font-size: 1.8rem;
    }
    
    .student-name {
        font-size: 1.6rem;
    }
    
    .course-name {
        font-size: 1.4rem;
    }
    
    .certificate-stats {
        flex-direction: column;
        gap: 1rem;
    }
    
    .certificate-footer {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .certificate-seal {
        position: static;
        margin: 1rem auto 0;
        transform: none;
    }
}
</style>

<script>
// Certificate functionality
function downloadCertificate() {
    // Cette fonction utiliserait une bibliothèque comme jsPDF ou html2canvas
    alert('🚀 Fonctionnalité de téléchargement PDF en développement!');
    
    // Exemple d'implémentation future:
    // const certificate = document.getElementById('certificate');
    // html2canvas(certificate).then(canvas => {
    //     const pdf = new jsPDF();
    //     pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0);
    //     pdf.save('certificat-{{ course.name }}.pdf');
    // });
}

function shareCertificate() {
    const shareModal = new bootstrap.Modal(document.getElementById('shareModal'));
    shareModal.show();
}

function shareOnLinkedIn() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(`J'ai terminé le cours {{ course.name }} sur Dev Learning Hub! 🎓`);
    window.open(`https://linkedin.com/sharing/share-offsite/?url=${url}&summary=${text}`, '_blank');
}

function shareOnTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(`🎓 J'ai terminé le cours {{ course.name }} sur @DevLearningHub! #apprentissage #développement #certificat`);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function copyLink() {
    copyShareLink();
    alert('✅ Lien copié dans le presse-papiers!');
}

function shareByEmail() {
    const subject = encodeURIComponent(`Certificat - {{ course.name }}`);
    const body = encodeURIComponent(`Bonjour,\n\nJe viens de terminer le cours "{{ course.name }}" sur Dev Learning Hub!\n\nVous pouvez voir mon certificat ici: ${window.location.href}\n\nCordialement,\n{{ current_user.username }}`);
    window.open(`mailto:?subject=${subject}&body=${body}`);
}

function copyShareLink() {
    const shareLink = document.getElementById('shareLink');
    shareLink.select();
    shareLink.setSelectionRange(0, 99999);
    document.execCommand('copy');
}

// Animation d'entrée
document.addEventListener('DOMContentLoaded', () => {
    const certificate = document.querySelector('.certificate');
    certificate.style.opacity = '0';
    certificate.style.transform = 'scale(0.9)';
    
    setTimeout(() => {
        certificate.style.transition = 'all 0.8s ease';
        certificate.style.opacity = '1';
        certificate.style.transform = 'scale(1)';
    }, 300);
    
    // Animation du sceau
    const seal = document.querySelector('.certificate-seal');
    setTimeout(() => {
        seal.style.animation = 'bounceIn 1s ease-in-out';
    }, 1000);
});

// Animation CSS pour le sceau
const style = document.createElement('style');
style.textContent = `
    @keyframes bounceIn {
        0% { transform: scale(0) rotate(-15deg); opacity: 0; }
        50% { transform: scale(1.1) rotate(-15deg); opacity: 0.8; }
        100% { transform: scale(1) rotate(-15deg); opacity: 1; }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
